---
layout: post
title:  "Windows内核一、Windows内核介绍"
date:   2018/09/11 23:00:00
categories: 内核
tag: 内核
---

# 80x86处理器的工作模式

80386处理器有3种工作模式：实模式、保护模式和虚拟86模式。其中实模式和虚拟86模式是为了兼容16位处理器而设置的。在实模式下，即相当于一个快速的8086处理器，对所有的内存都可读、可写、可执行，并且可以执行所有的特权指令(ring0)。大多数情况下，80386处理器运行在保护模式(32位)下，保护模式提供了多任务、内存分页管理和优先级保护机制。虚拟86模式是为了在保护模式下运行16位程序而设置的。

# 电脑从启动到运行发生了什么

1. CPU通电
2. 从主板取出BIOS加载到内存，并执行
3. BIOS判断部分硬件是否有效后，从硬盘引导扇区(硬盘的第一个扇区)取出MBR加载到内存，并执行
4. MBR进行某些操作后，将操作系统代码取出并加载到内存，并执行

> MBR中的代码不属于操作系统，并且只认识16位汇编。因为CPU启动后进入的是实模式，即时到如今的64位CPU也是。后面再切换到保护模式只需要一条汇编指令。取出MBR中的代码同样只能使用16位汇编，使用中断来取出。PCHunter便可以取出和载入，但是安全软件会监控MBR是否会被修改，如果正常关机重启会被恢复，此时需要强制断电后重启，即可运行修改后的MBR中的代码了。

# 内核的学习

需要对CPU部分了解，对操作系统部分了解，可以通过查询Intel官方文档来看CPU是怎样设计的，看文档对写操作系统的要求，另外Windows已有被人逆向的内核源码流出在外，也可进行学习。